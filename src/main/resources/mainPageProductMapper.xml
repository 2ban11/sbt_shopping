<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sbt.shopping.kimoon.MainPageProductMapper">

<select id="get48Products" resultType="com.sbt.shopping.product.Product">
SELECT *
FROM (
    SELECT
        p_no,
        p_big_category,
        p_middle_category,
        p_small_category,
        p_maker,
        p_name,
        p_img1,
        p_img2,
        p_content,
        p_color,
        p_price,
        p_sale,
        p_cnt,
        p_date,
        ROW_NUMBER() OVER (PARTITION BY p_big_category, p_middle_category ORDER BY p_no) AS row_num
    FROM product
) ranked_products
WHERE
    (p_big_category = '기타' AND row_num &lt;= 3) OR
    (p_big_category = '앰프' AND row_num &lt;= 4) OR
    (p_big_category = '이펙터' AND row_num &lt;= 3) OR
    (p_big_category = '주변용품' AND row_num &lt;= 3)
ORDER BY p_big_category, p_middle_category, row_num
</select>

</mapper>