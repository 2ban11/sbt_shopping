<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sbt.shopping.kimoon.MainPageProductMapper">

<select id="searchProducts" resultType="com.sbt.shopping.jaehwan.ProductDTO">
	select * from product where LOWER(p_name) like '%' ||  LOWER(#{search}) || '%'
</select>



<select id="getMainPageProducts" resultType="com.sbt.shopping.product.Product">
SELECT *	
FROM (
    SELECT
        p_no,
        p_big_category,
        p_middle_category,
        p_small_category,
        p_maker,
        p_name,
        p_img1,
        p_img2,
        p_content,
        p_color,
        p_price,
        p_sale,
        p_cnt,
        p_date,
        ROW_NUMBER() OVER (PARTITION BY p_big_category, p_middle_category ORDER BY p_no) AS row_num
    FROM product
) ranked_products
WHERE
    (p_big_category = '기타' AND p_middle_category != '우쿠렐레기타' AND row_num &lt;= 3) OR
    (p_big_category = '앰프' AND row_num &lt;= 4) OR
    (p_big_category = '이펙터' AND row_num &lt;= 3) OR
    (p_big_category = '주변용품' AND row_num &lt;= 3)
ORDER BY p_big_category, p_middle_category, row_num
</select>

<!-- 장바구니 중복확인 -->
<select id="checkDupliCart" resultType="int">
	SELECT COUNT(*) FROM CART WHERE C_ID = #{c_id} AND C_PRODUCT = #{c_product}
</select>

<!-- 장바구니 등록 -->
<insert id="insertMainPageCart">
	INSERT INTO cart VALUES (cart_seq.nextval, #{c_id}, #{c_product}, 1)
</insert>

<!-- 장바구니 갯수 증가 -->
<update id="updateMainCart">
	UPDATE cart SET c_cnt = c_cnt + 1 WHERE c_id = #{c_id} and c_product = #{c_product}
</update>

</mapper>